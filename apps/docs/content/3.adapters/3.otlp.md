---
title: OTLP Adapter
description: Send logs via OpenTelemetry Protocol to Grafana, Datadog, Honeycomb, and any OTLP-compatible backend.
navigation:
  title: OTLP
  icon: i-simple-icons-opentelemetry
links:
  - label: OpenTelemetry Docs
    icon: i-lucide-external-link
    to: https://opentelemetry.io/docs/
    target: _blank
    color: neutral
    variant: subtle
  - label: Custom Adapters
    icon: i-lucide-code
    to: /adapters/custom
    color: neutral
    variant: subtle
---

The OTLP (OpenTelemetry Protocol) adapter sends logs in the standard OpenTelemetry format. This works with any OTLP-compatible backend including:

- **Grafana Cloud** (Loki)
- **Datadog**
- **Honeycomb**
- **Jaeger**
- **Splunk**
- **New Relic**
- **Self-hosted OpenTelemetry Collector**

## Installation

The OTLP adapter comes bundled with evlog:

```typescript [server/plugins/evlog-drain.ts]
import { createOTLPDrain } from 'evlog/otlp'
```

## Quick Start

### 1. Set your OTLP endpoint

```bash [.env]
NUXT_OTLP_ENDPOINT=http://localhost:4318
```

### 2. Create the drain plugin

```typescript [server/plugins/evlog-drain.ts]
import { createOTLPDrain } from 'evlog/otlp'

export default defineNitroPlugin((nitroApp) => {
  nitroApp.hooks.hook('evlog:drain', createOTLPDrain())
})
```

## Configuration

The adapter reads configuration from multiple sources (highest priority first):

1. **Overrides** passed to `createOTLPDrain()`
2. **Runtime config** at `runtimeConfig.evlog.otlp`
3. **Runtime config** at `runtimeConfig.otlp`
4. **Environment variables** (`NUXT_OTLP_*` or `OTEL_*`)

### Environment Variables

| Variable | Description |
|----------|-------------|
| `NUXT_OTLP_ENDPOINT` | OTLP HTTP endpoint (e.g., `http://localhost:4318`) |
| `NUXT_OTLP_SERVICE_NAME` | Override service name |
| `NUXT_OTLP_HEADERS` | Custom headers (format: `Key=Value,Key2=Value2`) |
| `NUXT_OTLP_AUTH` | Shortcut for `Authorization` header |

Standard OpenTelemetry variables are also supported:

| Variable | Description |
|----------|-------------|
| `OTEL_EXPORTER_OTLP_ENDPOINT` | OTLP endpoint (fallback) |
| `OTEL_EXPORTER_OTLP_HEADERS` | Headers in OTEL format |
| `OTEL_SERVICE_NAME` | Service name (fallback) |

### Runtime Config

```typescript [nuxt.config.ts]
export default defineNuxtConfig({
  runtimeConfig: {
    otlp: {
      endpoint: '', // Set via NUXT_OTLP_ENDPOINT
    },
  },
})
```

### Override Options

```typescript [server/plugins/evlog-drain.ts]
import { createOTLPDrain } from 'evlog/otlp'

export default defineNitroPlugin((nitroApp) => {
  nitroApp.hooks.hook('evlog:drain', createOTLPDrain({
    endpoint: 'http://localhost:4318',
    serviceName: 'my-api',
    headers: {
      'Authorization': 'Bearer xxx',
    },
    resourceAttributes: {
      'deployment.environment': 'staging',
    },
  }))
})
```

### Full Configuration Reference

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `endpoint` | `string` | - | OTLP HTTP endpoint (required) |
| `serviceName` | `string` | From event | Override `service.name` resource attribute |
| `headers` | `object` | - | Custom HTTP headers for authentication |
| `resourceAttributes` | `object` | - | Additional OTLP resource attributes |
| `timeout` | `number` | `5000` | Request timeout in milliseconds |

## Provider-Specific Setup

### Grafana Cloud

1. Go to your Grafana Cloud portal
2. Navigate to **Connections** > **Collector** > **OpenTelemetry**
3. Copy your OTLP endpoint and generate credentials

```bash [.env]
NUXT_OTLP_ENDPOINT=https://otlp-gateway-prod-us-central-0.grafana.net/otlp
OTEL_EXPORTER_OTLP_HEADERS=Authorization=Basic%20base64-encoded-credentials
```

::callout{icon="i-lucide-info" color="info"}
Grafana uses URL-encoded headers. The `%20` is a space character. The adapter automatically decodes this format.
::

### Datadog

```bash [.env]
NUXT_OTLP_ENDPOINT=https://http-intake.logs.datadoghq.com
NUXT_OTLP_HEADERS=DD-API-KEY=your-api-key
```

### Local OpenTelemetry Collector

For development and testing, run a local collector:

```yaml [otel-collector.yaml]
receivers:
  otlp:
    protocols:
      http:
        endpoint: 0.0.0.0:4318

exporters:
  debug:
    verbosity: detailed

service:
  pipelines:
    logs:
      receivers: [otlp]
      exporters: [debug]
```

```bash
docker run --rm -p 4318:4318 \
  -v $(pwd)/otel-collector.yaml:/etc/otelcol/config.yaml \
  otel/opentelemetry-collector:latest
```

```bash [.env]
NUXT_OTLP_ENDPOINT=http://localhost:4318
```

## OTLP Log Format

evlog maps wide events to the OTLP log format:

| evlog Field | OTLP Field |
|-------------|------------|
| `level` | `severityNumber` / `severityText` |
| `timestamp` | `timeUnixNano` |
| `service` | Resource attribute `service.name` |
| `environment` | Resource attribute `deployment.environment` |
| `version` | Resource attribute `service.version` |
| `region` | Resource attribute `cloud.region` |
| `traceId` | `traceId` |
| `spanId` | `spanId` |
| All other fields | Log attributes |

### Severity Mapping

| evlog Level | OTLP Severity Number | OTLP Severity Text |
|-------------|---------------------|-------------------|
| `debug` | 5 | DEBUG |
| `info` | 9 | INFO |
| `warn` | 13 | WARN |
| `error` | 17 | ERROR |

## Troubleshooting

### Missing endpoint error

```
[evlog/otlp] Missing endpoint. Set NUXT_OTLP_ENDPOINT or OTEL_EXPORTER_OTLP_ENDPOINT
```

Make sure your endpoint environment variable is set and the server was restarted.

### 401 Unauthorized

Your authentication headers may be missing or incorrect. Check:

1. The `OTEL_EXPORTER_OTLP_HEADERS` format is correct
2. Credentials are valid and not expired
3. The endpoint URL is correct

### 404 Not Found

The adapter sends to `/v1/logs`. Make sure your endpoint:
- Supports OTLP HTTP (not gRPC)
- Is the base URL without `/v1/logs` suffix

### Logs not appearing

1. Check the server console for `[evlog/otlp]` error messages
2. Test with a local collector first to verify the format
3. Check your backend's ingestion delay (some have 1-2 minute delays)

## Direct API Usage

For advanced use cases:

```typescript [server/utils/otlp.ts]
import { sendToOTLP, sendBatchToOTLP, toOTLPLogRecord } from 'evlog/otlp'

// Send a single event
await sendToOTLP(event, {
  endpoint: 'http://localhost:4318',
})

// Send multiple events
await sendBatchToOTLP(events, {
  endpoint: 'http://localhost:4318',
})

// Convert event to OTLP format (for inspection)
const otlpRecord = toOTLPLogRecord(event)
```

## Next Steps

- [Axiom Adapter](/adapters/axiom) - Send logs to Axiom
- [PostHog Adapter](/adapters/posthog) - Send logs to PostHog
- [Custom Adapters](/adapters/custom) - Build your own adapter
- [Best Practices](/core-concepts/best-practices) - Security and production tips
